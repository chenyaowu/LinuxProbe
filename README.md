# LinuxProbe
# 第2章-新手必须掌握的 Linux 命令 



## 常用系统工作命令



### 1.echo命令

- echo 命令用于在终端输出字符串或变量提取后的值，格式为“echo [字符串 | $变量]”。

  ```bash
  [root@linuxprobe ~]# echo Linuxprobe.Com
  Linuxprobe.Com
  [root@linuxprobe ~]# echo $SHELL
  /bin/bash
  ```

### 2.date命令

- date 命令用于显示及设置系统的时间或日期，格式为“date [选项] [+指定的格式]”。

  | 参数 | 作用           |
  | ---- | -------------- |
  | %t   | 跳格[Tab键]    |
  | %H   | 小时(00~23)    |
  | %I   | 小时(00~12)    |
  | %M   | 分钟(00~59)    |
  | %s   | 秒(00~59)      |
  | %j   | 今年中的第几天 |

  ```ba
  按照默认格式查看当前系统时间
  [root@linuxprobe ~]# date
  Mon Aug 24 16:11:23 CST 2017 
  按照“年-月-日 小时:分钟:秒”的格式查看当前系统时间
  [root@linuxprobe ~]# date "+%Y-%m-%d %H:%M:%S"
  2017-08-24 16:29:12 
  设置时间
  [root@linuxprobe ~]# date -s "20170901 8:30:00"
  Fri Sep 1 08:30:00 CST 2017 
  查看今天是当年中的第几天
  [root@linuxprobe ~]# date "+%j" 
  244
  ```

### 3.reboot命令

- reboot 命令用于重启系统

### 4.poweroff 命令

- poweroff 命令用于关闭系统

### 5.wget 命令

- wget 命令用于在终端中下载网络文件，格式为“wget [参数] 下载地址”。

  | 参数 | 作用                               |
  | ---- | ---------------------------------- |
  | -b   | 后台下载模式                       |
  | -P   | 下载到指定目录                     |
  | -t   | 最大尝试次数                       |
  | -c   | 断点续传                           |
  | -p   | 下载页面所有资源，包括图片、视频等 |
  | -r   | 递归下载                           |

  

### 6.ps命令

- ps 命令用于查看系统中的进程状态，格式为“ps [参数]”。

  | 参数 | 作用                               |
  | ---- | ---------------------------------- |
  | -a   | 显示所有进程（包括其他用户的进程） |
  | -u   | 用户以及其他详细信息               |
  | -x   | 显示没有控制终端的进程             |

- 5种常见的进程状态

  - R（运行）：进程正在运行或在运行队列中等待。 
  -  S（中断）：进程处于休眠中，当某个条件形成后或者接收到信号时，则脱离该 状态。 
  - D（不可中断）：进程不响应系统异步信号，即便用 kill 命令也不能将其中断。 
  - Z（僵死）：进程已经终止，但进程描述符依然存在, 直到父进程调用 wait4()系统函数 后将进程释放。 
  - T（停止）：进程收到停止信号后停止运行。

- ps输出信息

  | USER         | PID      | %CPU         | %MEM       | VSZ                  | RSS                    | TTY        | STAT     | START        | TIME              | COMMAND          |
  | ------------ | -------- | ------------ | ---------- | -------------------- | ---------------------- | ---------- | -------- | ------------ | ----------------- | ---------------- |
  | 进程的所有者 | 进程ID号 | 运算器占用率 | 内存占用率 | 虚拟内存使用量（KB） | 占用的固定内存量（KB） | 所在的终端 | 进程状态 | 被启动的时间 | 实际使用CPU的时间 | 命令名称与参数   |
  | root         | 1        | 0.0          | 0.14       | 53684                | 7628                   | ?          | Ss       | 07:00        | 0:22              | /usr/lib/systemd |

### 7.top 命令

- top 命令用于动态地监视进程活动与系统负载等信息
  - 第 1 行：系统时间、运行时间、登录终端数、系统负载（三个数值分别为 1 分钟、5 分钟、15 分钟内的平均值，数值越小意味着负载越低）。 
  - 第 2 行：进程总数、运行中的进程数、睡眠中的进程数、停止的进程数、僵死的进程 数。 
  - 第 3 行：用户占用资源百分比、系统内核占用资源百分比、改变过优先级的进程资源 百分比、空闲的资源百分比等。(数据均为 CPU 数据并以百分比格式显示，例如“97.1 id”意味着有 97.1% 的 CPU 处理器资源处于空闲。)
  - 第 4 行：物理内存总量、内存使用量、内存空闲量、作为内核缓存的内存量。 
  - 第 5 行：虚拟内存总量、虚拟内存使用量、虚拟内存空闲量、已被提前加载的内存量。

### 8.pidof 命令 

- pidof 命令用于查询某个指定服务进程的 PID 值，格式为“pidof [参数] [服务名称]”。

  ```ba
  [root@linuxprobe ~]# pidof sshd
  2156 
  ```

### 9.kill 命令

- kill 命令用于终止某个指定 PID 的服务进程，格式为“kill [参数] [进程 PID]”。

### 10.killall 命令

 - killall 命令用于终止某个指定名称的服务所对应的全部进程，格式为：“killall [参数] [进 程名称]”。



 ## 系统状态检测命令 

### 1.ifconfig 命令

- ifconfig 命令用于获取网卡配置与网络状态等信息，格式为“ifconfig [网络设备] [参数]”。

### 2.uname 命令 

- uname 命令用于查看系统内核与系统版本等信息，格式为“uname [-a]”。

### 3.uptime 命令

- uptime 用于查看系统的负载信息，格式为 uptime

### 4.free 命令

- free 用于显示当前系统中内存的使用量信息，格式为“free [-h]”。

  |                  | 内存总量 | 已用量 | 可用量 | 进程共享的内存量 | 磁盘缓存的内存量 | 缓存的内存量 |
  | ---------------- | -------- | ------ | ------ | ---------------- | ---------------- | ------------ |
  |                  | total    | used   | free   | shared           | buffers          | cached       |
  | Mem              | 1.8GB    | 1.3GB  | 542MB  | 9.8MB            | 1.6MB            | 413MB        |
  | -/+buffers/cache |          | 869MB  | 957MB  |                  |                  |              |
  | Swap             | 2.0GB    | 0      | 2.0GB  |                  |                  |              |

### 5.who 命令

- who 用于查看当前登入主机的用户终端信息，格式为“who [参数]”。

  | 登录的用户名 | 终端设备 | 登录到系统的时间     |
  | ------------ | -------- | -------------------- |
  | root         | :0       | 2017-08-24 17:52(:0) |
  | root         | pts/0    | 2017-08-24 17:52(:0) |

### 6.last 命令

- last 命令用于查看所有系统的登录记录，格式为“last [参数]”。

### 7.history 命令 

- history 命令用于显示历史执行过的命令，格式为“history [-c]”。

### 8.sosreport 命令 

- sosreport 命令用于收集系统配置及架构信息并输出诊断文档，格式为 sosreport。

## 工作目录切换命令 

### 1.pwd 命令

- pwd 命令用于显示用户当前所处的工作目录，格式为“pwd [选项]”。

### 2.cd 命令

- cd 命令用于切换工作路径，格式为“cd [目录名称]”。

### 3.ls 命令

- ls 命令用于显示目录中的文件信息，格式为“ls [选项] [文件] ”。
  - “-a”参数看 到全部文件（包括隐藏文件）。
  - “-l”参数可以查看文件的属性、大小等详细信息。
  - “-d”参数查看目录属性信息

## 文本文件编辑命令 

### 1.cat 命令

- cat 命令用于查看纯文本文件（内容较少的），格式为“cat [选项] [文件]”。
  - 显示行号加-n参数

### 2.more 命令

- more 命令用于查看纯文本文件（内容较多的），格式为“more [选项]文件”。
  - 使用空格键或回 车键向下翻页

### 3.head 命令

- head 命令用于查看纯文本文档的前 N 行，格式为“head [选项] [文件]”。

### 4.tail 命令

- tail 命令用于查看纯文本文档的后 N 行或持续刷新内容，格式为“tail [选项] [文件]”。

  ```bash
  查看最后20行
  [root@linuxprobe ~]# tail -n 20 /var/log/messages 
  ```

### 5. tr 命令

- tr 命令用于替换文本文件中的字符，格式为“tr [原始字符] [目标字符]”。

### 6.wc 命令

- wc 命令用于统计指定文本的行数、字数、字节数，格式为“wc [参数] 文本”。

  | 参数 | 作用         |
  | ---- | ------------ |
  | -l   | 只显示行数   |
  | -w   | 只显示单词数 |
  | -c   | 只显示字节数 |

### 7.stat 命令 

- stat 命令用于查看文件的具体存储信息和时间等信息，格式为“stat 文件名称”。

### 8.cut 命令

- cut 命令用于按“列”提取文本字符，格式为“cut [参数] 文本”。

### 9.diff 命令

- diff 命令用于比较多个文本文件的差异，格式为“diff [参数] 文件”。

## 文件目录管理命令

### 1.touch 命令

- touch 命令用于创建空白文件或设置文件的时间，格式为“touch [选项] [文件]”。

  | 参数 | 作用                    |
  | ---- | ----------------------- |
  | -a   | 仅修改“读取时间”(atime) |
  | -m   | 仅修改“修改时间”(mtime) |
  | -d   | 同时修改atime与mtime    |

### 2.mkdir 命令

- mkdir 命令用于创建空白的目录，格式为“mkdir [选项] 目录”。

  ```bash
  使用-p递归创建层级关系目录
  [root@linuxprobe linuxprobe]# mkdir -p a/b/c/d/e 
  ```

### 3.cp 命令 

- cp 命令用于复制文件或目录，格式为“cp [选项] 源文件 目标文件”。

  - 如果目标文件是目录，则会把源文件复制到该目录中；

  - 如果目标文件也是普通文件，则会询问是否要覆盖它；

  - 如果目标文件不存在，则执行正常的复制操作。

    | 参数 | 作用                                         |
    | ---- | -------------------------------------------- |
    | -p   | 保留原始文件的属性                           |
    | -d   | 若对象为“链接文件”，则保留该“链接文件”的属性 |
    | -r   | 递归持续复制（用于目录）                     |
    | -i   | 若目标文件存在则询问是否覆盖                 |
    | -a   | 相当于-pdr（p、d、r 为上述参数）             |

### 4.mv 命令

- mv 命令用于剪切文件或将文件重命名，格式为“mv [选项] 源文件 [目标路径|目标文件名]”。

### 5.rm 命令

- rm 命令用于删除文件或目录，格式为“rm [选项] 文件”。

### 6. dd 命令

- dd 命令用于按照指定大小和个数的数据块来复制文件或转换文件，格式为“dd [参数]”。

### 7.file 命令

- file 命令用于查看文件的类型，格式为“file 文件名”。

## 打包压缩与搜索命令

### 1.tar 命令

- tar 命令用于对文件进行打包压缩或解压，格式为“tar [选项] [文件]”。

  | 参数 | 作用                   |
  | ---- | ---------------------- |
  | -c   | 创建压缩文件           |
  | -x   | 解开压缩文件           |
  | -t   | 查看压缩包内有哪些文件 |
  | -z   | 用 Gzip 压缩或解压     |
  | -j   | 用 bzip2 压缩或解压    |
  | -v   | 显示压缩或解压的过程   |
  | -f   | 目标文件名             |
  | -p   | 保留原始的权限与属性   |
  | -P   | 使用绝对路径来压缩     |
  | -C   | 指定解压到的目录       |

### 2.grep 命令 

- grep 命令用于在文本中执行关键词搜索，并显示匹配的结果，格式为“grep [选项] [文件]”。

  | 参数 | 作用                                             |
  | ---- | ------------------------------------------------ |
  | -b   | 将可执行文件（binary）当作文本文件（text）来搜索 |
  | -c   | 仅显示找到的行数                                 |
  | -i   | 忽略大小写                                       |
  | -n   | 显示行号                                         |
  | -v   | 反向选择—仅列出没有“关键词”的行                  |

### 3.find 命令

- find 命令用于按照指定条件来查找文件，格式为“find [查找路径] 寻找条件 操作”。

  | 参数               | 作用                                                         |
  | ------------------ | ------------------------------------------------------------ |
  | -name              | 匹配名称                                                     |
  | -perm              | 匹配权限（mode 为完全匹配，-mode 为包含即可                  |
  | -user              | 匹配所有者                                                   |
  | -group             | 匹配所有组                                                   |
  | -mtime -n +n       | 匹配修改内容的时间（-n 指 n 天以内，+n 指 n 天以前）         |
  | -atime -n +n       | 匹配访问文件的时间（-n 指 n 天以内，+n 指 n 天以前）         |
  | -ctime -n +n       | 匹配修改文件权限的时间（-n 指 n 天以内，+n 指 n 天以前）     |
  | -nouser            | 匹配无所有者的文件                                           |
  | -nogroup           | 匹配无所有组的文件                                           |
  | -newer f1 !f2      | 匹配比文件 f1 新但比 f2 旧的文件                             |
  | --type b/d/c/p/l/f | 匹配文件类型（后面的字幕参数依次表示块设备、目录、字符设备、管道、 链接文件、文本文件） |
  | -size              | 匹配文件的大小（+50KB 为查找超过 50KB 的文件，而-50KB 为查找小于 50KB 的文件） |
  | -prune             | 忽略某个目录                                                 |
  | -exec …… {}\;      | 后面可跟用于进一步处理搜索结果的命令                         |

  

# 第3章管道符、重定向与环境变量

## 输入输出重定向

- 输入重定向是指把文件导入到命令中，而输出重定向则是指把原本要输出到 屏幕的数据信息写入到指定文件中

- 标准输入重定向（STDIN，文件描述符为 0）：默认从键盘输入，也可从其他文件或命令中输入

- 标准输出重定向（STDOUT，文件描述符为 1）：默认输出到屏幕。

- 错误输出重定向（STDERR，文件描述符为 2）：默认输出到屏幕。

- 输入重定向中用到的符号及其作用

  | 符号                   | 作用                                            |
  | ---------------------- | ----------------------------------------------- |
  | 命令 < 文件            | 将文件作为命令的标准输入                        |
  | 命令 << 分界符         | 从标准输入中读入，直到遇见分界符才停止          |
  | 命令 < 文件 1 > 文件 2 | 将文件 1 作为命令的标准输入并将标准输出到文件 2 |

  

- 输出重定向中用到的符号及其作用

  - 对于重定向中的标准输出模式，可以省略文件描述符 1 不写，而错误输出模式的文件描述符 2 是必须要写的。

  | 符号                               | 作用                                                         |
  | ---------------------------------- | ------------------------------------------------------------ |
  | 命令 > 文件                        | 将标准输出重定向到一个文件中（清空原有文件的数据）           |
  | 命令 2> 文件                       | 将错误输出重定向到一个文件中（清空原有文件的数据）           |
  | 命令 >> 文件                       | 将标准输出重定向到一个文件中（追加到原有内容的后面）         |
  | 命令 2>> 文件                      | 将错误输出重定向到一个文件中（追加到原有内容的后面）         |
  | 命令 >> 文件 2>&1 或 命令 &>> 文件 | 将标准输出与错误输出共同写入到文件中（追加到原有内容的 后面） |

## 管道命令符

- 格式 命令 A | 命令 B |

- 把前一个命令原本要输出到屏幕的数据当作是后一个命令的标准输 入

## 命令行的通配符 

- 星号（*）代 表匹配零个或多个字符
- 问号（?）代表匹配单个字符
- 中括号内加上数字[0-9]代表匹配 0～9 之间的单个数字的字符
- 中括号内加上字母[abc]则是代表匹配 a、b、c 三个字符中的任意 一个字符。

## 常用的转义字符 

- 反斜杠（\）：使反斜杠后面的一个变量变为单纯的字符串。
- 单引号（''）：转义其中所有的变量为单纯的字符串。
- 双引号（""）：保留其中的变量属性，不进行转义处理。
- 反引号（``）：把其中的命令执行后返回结果。

## 重要的环境变量 

- 在用 户执行了一条命令之后，分别执行4个步骤

  - 第1步：判断用户是否以绝对路径或相对路径的方式输入命令（如/bin/ls），如果是的话 则直接执行。
  - 第2步：Linux 系统检查用户输入的命令是否为“别名命令”，即用一个自定义的命令 名称来替换原本的命令名称。可以用 alias 命令来创建一个属于自己的命令别名，格式为 “alias 别名=命令”。若要取消一个命令别名，则是用 unalias 命令，格式为“unalias 别名”。 
  - 第3步：Bash 解释器判断用户输入的是内部命令还是外部命令。内部命令是解释器内部 的指令，会被直接执行；而用户在绝大部分时间输入的是外部命令，这些命令交由步骤 4 继 续处理。可以使用“type 命令名称”来判断用户输入的命令是内部命令还是外部命令。
  - 第4步：系统在多个路径中查找用户输入的命令文件，而定义这些路径的变量叫作 PATH，可 以简单地把它理解成是“解释器的小助手”，作用是告诉 Bash 解释器待执行的命令可能存放 的位置，然后 Bash 解释器就会乖乖地在这些位置中逐个查找。PATH 是由多个路径值组成的 变量，每个路径值之间用冒号间隔，对这些路径的增加和删除操作将影响到 Bash 解释器对 Linux 命令的查找。

- 为什么不能将当前目录（.）添加到 PATH 中呢? 

  - 尽管可以将当前目录（.）添加到 PATH 变量中，从而在某些情况下可以让用户免去输入命令 所在路径的麻烦。但是，如果黑客在比较常用的公共目录/tmp 中存放了一个与 ls 或 cd 命令同 名的木马文件，而用户又恰巧在公共目录中执行了这些命令，那么就极有可能中招了。

- Linux 系统中最重要的 10 个环境变量

  | 变量名称     | 作用                             |
  | ------------ | -------------------------------- |
  | HOME         | 用户的主目录（即家目录）         |
  | SHELL        | 用户在使用的 Shell 解释器名称    |
  | HISTSIZE     | 输出的历史命令记录条数           |
  | HISTFILESIZE | 保存的历史命令记录条数           |
  | MAIL         | 邮件保存路径                     |
  | LANG         | 系统语言、语系名称               |
  | RANDOM       | 生成一个随机数字                 |
  | PS1          | Bash 解释器的提示符              |
  | PATH         | 定义解释器搜索用户执行命令的路径 |
  | EDITOR       | 用户默认的文本编辑器             |




## Vim 编辑器与 Shell 命令脚本 

### Vim 文本编辑器

- 三种模式

  - 命令模式：控制光标移动，可对文本进行复制、粘贴、删除和查找等工作。
  - 输入模式：正常的文本录入。
  - 末行模式：保存或退出文档，以及设置编辑环境。

- Vim 中常用的命令

  | 命令 | 作用                                               |
  | ---- | -------------------------------------------------- |
  | dd   | 删除（剪切）光标所在整行                           |
  | 5dd  | 删除（剪切）从光标处开始的 5 行                    |
  | yy   | 复制光标所在整行                                   |
  | 5yy  | 复制从光标处开始的 5 行                            |
  | n    | 显示搜索命令定位到的下一个字符串                   |
  | N    | 显示搜索命令定位到的上一个字符串                   |
  | u    | 撤销上一步的操作                                   |
  | p    | 将之前删除（dd）或复制（yy）过的数据粘贴到光标后面 |

- 末行模式中可用的命令

  | 命令          | 作用                                    |
  | ------------- | --------------------------------------- |
  | :w            | 保存                                    |
  | :q            | 退出                                    |
  | :q!           | 强制退出（放弃对文档的修改内容）        |
  | :wq!          | 强制保存退出                            |
  | :set nu       | 显示行号                                |
  | :set nonu     | 不显示行号                              |
  | :命令         | 执行该命令                              |
  | :整数         | 跳转到该行                              |
  | :s/one/two    | 将当前光标所在行的第一个 one 替换成 two |
  | :s/one/two/g  | 将当前光标所在行的所有 one 替换成 two   |
  | :%s/one/two/g | 将全文中的所有 one 替换成 two           |
  | ?字符串       | 在文本中从下至上搜索该字符串            |
  | /字符串       | 在文本中从上至下搜索该字符串            |

  

### 编写 Shell 脚本

- Shell 脚本命令的工作方式有两种：交互式和批处理

  - 交互式（Interactive）：用户每输入一条命令就立即执行。
  - 批处理（Batch）：由用户事先编写好一个完整的 Shell 脚本，Shell 会一次性执行脚本 中诸多的命令。

- 编写简单的脚本 

  ```bash
  [root@linuxprobe ~]# vim example.sh
  #!/bin/bash
  #For Example BY linuxprobe.com
  pwd
  ls -al 
  --------------------------------------------
  [root@linuxprobe ~]# bash example.sh
  /root/Desktop
  total 8
  drwxr-xr-x. 2 root root 23 Jul 23 17:31 .
  dr-xr-x---. 14 root root 4096 Jul 23 17:31 ..
  -rwxr--r--. 1 root root 55 Jul 23 17:31 example.sh 
  ```

  - Shell 脚本文件的名称可以任意，但为了避免被误以为是普通文件，建议将.sh 后缀加上，以表示是一个脚本文件。
  - 在上面的这个 example.sh 脚本中实际上出现了三种不同的元素：
    - 第一行的 脚本声明（#!）用来告诉系统使用哪种 Shell 解释器来执行该脚本；
    - 第二行的注释信息（#）是对 脚本功能和某些命令的介绍信息，使得自己或他人在日后看到这个脚本内容时，可以快速知道该 脚本的作用或一些警告信息；
    - 第三、四行的可执行语句也就是我们平时执行的 Linux 命令了

- 接收用户的参数

  - 如\$0 对应的是当前 Shell 脚本程序的名称
  - \$#对应的是总共 有几个参数，
  - \$*对应的是所有位置的参数值
  - \$?对应的是显示上一次命令的执行返回值
  -  \$1、\$2、\$3……则分别对应着第 N 个位置的参数值
  
  ```bash
  [root@linuxprobe ~]# vim example.sh
  #!/bin/bash
  echo "当前脚本名称为$0"
  echo "总共有$#个参数，分别是$*。"
  echo "第 1 个参数为$1，第 5 个为$5。"
  -------------------------------------------------------
  [root@linuxprobe ~]# sh example.sh one two three four five six
  当前脚本名称为 example.sh
  总共有 6 个参数，分别是 one two three four five six。
  第 1 个参数为 one，第 5 个为 five。
  ```
  
- 判断用户的参数

  - 测试语句格式（两边有空格）： [ 条件语句 ]

    | 运算符 | 作用                       |
    | ------ | -------------------------- |
    | -d     | 测试文件是否为目录类型     |
    | -e     | 测试文件是否存在           |
    | -f     | 判断是否为一般文件         |
    | -r     | 测试当前用户是否有权限读取 |
    | -w     | 测试当前用户是否有权限写入 |
    | -x     | 测试当前用户是否有权限执行 |

    ```bash
    [root@linuxprobe ~]# [ -d /etc/fstab ]
    [root@linuxprobe ~]# echo $?
    1 
    ```

    

  - 逻辑“与”的运算符号是&&，逻辑“与”的运算符号是||，逻辑语句是“非”运算符号是！

    ```bash
    [root@linuxprobe ~]# [ ! $USER = root ] && echo "user" || echo "root"
    root 
    ```

    

    - 可用的整数比较运算符

      | 运算符 | 作用           |
      | ------ | -------------- |
      | -eq    | 是否等于       |
      | -ne    | 是否不等于     |
      | -gt    | 是否大于       |
      | -lt    | 是否小于       |
      | -le    | 是否等于或小于 |
      | -ge    | 是否大于或等于 |

    ```bash
    [root@linuxprobe ~]# [ 10 -gt 10 ]
    [root@linuxprobe ~]# echo $?
    1
    [root@linuxprobe ~]# [ 10 -eq 10 ]
    [root@linuxprobe ~]# echo $?
    0
    ```

    - 常见的字符串比较运算符

      | 运算符 | 作用                   |
      | ------ | ---------------------- |
      | =      | 比较字符串内容是否相同 |
      | !=     | 比较字符串内容是否不同 |
      | -z     | 判断字符串内容是否为空 |

      ```bash
      [root@linuxprobe ~]# [ -z $String]
      [root@linuxprobe ~]# echo $?
      0 
      ```

###  流程控制语句 

  - if 条件测试语句

      - if 条件语句的单分支结构由 if、then、fi 关键词组成，而且只在条件成立后才执行预设的 命令
      - if 条件语句的双分支结构由 if、then、else、fi 关键词组成，它进行一次条件匹配判断， 如果与条件匹配，则去执行相应的预设命令；反之则去执行不匹配时的预设命令
      - if 条件语句的多分支结构由 if、then、else、elif、fi 关键词组成，它进行多次条件匹配判 断，这多次判断中的任何一项在匹配成功后都会执行相应的预设命令

- for 条件循环语句 

  ```bash
  for 变量名 in 取值列表
  do
  	命令序列
  done
  ```

- while 条件循环语句 

  ```bash
  while 条件测试操作
  do
  	命令序列
  done
  ```

- case 条件测试语句 

  ```bash
  case 变量值 in
  模式1)
  	命令序列2
  	;;
  模式2)
  	命令序列2
  	;;
  	......
  *)
  	默认命令序列
  esac
  ```

  

  ### 计划任务服务程序 

- crond 服务
  
  - 分、时、日、月、星期 命令

| 字段 | 说明                                           |
| ---- | ---------------------------------------------- |
| 分   | 取值为 0～59 的整数                            |
| 时   | 取值为 0～23 的任意整数                        |
| 日   | 取值为 1～31 的任意整数                        |
| 月   | 取值为 1～12 的任意整数                        |
| 星期 | 取值为 0～7 的任意整数，其中 0 与 7 均为星期日 |
| 命令 | 要执行的命令或程序脚本                         |



## 用户身份与文件权限 

### 用户身份与能力

- 管理员 UID 为 0：系统的管理员用户。
- 系统用户 UID 为 1～999： Linux 系统为了避免因某个服务程序出现漏洞而被黑客提 权至整台服务器，默认服务程序会有独立的系统用户负责运行，进而有效控制被破坏 范围。
- 普通用户 UID 从 1000 开始：是由管理员创建的用于日常工作的用户。



- UID 是不能冲突的，而且管理员创建的普通用户的 UID 默认是从 1000 开始的（即使前面有闲置的号码）。
- Linux 系统中还引入了用户组的概念。通过使用用 户组号码（GID，Group IDentification），我们可以把多个用户加入到同一个组中，从而方 便为组中的用户统一规划权限或指定任务。
- 在 Linux 系统中创建每个用户时，将自动创建一个与其同名的基本用户组，而且 这个基本用户组只有该用户一个人。如果该用户以后被归纳入其他用户组，则这个其他用户 组称之为扩展用户组。一个用户只有一个基本用户组，但是可以有多个扩展用户组，从而满 足日常的工作需要。

### useradd 命令 

- useradd 命令用于创建新的用户，格式为“useradd [选项] 用户名”。

- 可以使用 useradd 命令创建用户账户。使用该命令创建用户账户时，默认的用户家目录会 被存放在/home 目录中，默认的 Shell 解释器为/bin/bash，而且默认会创建一个与该用户同名 的基本用户组

  | 参数 | 作用                                     |
  | ---- | ---------------------------------------- |
  | -d   | 指定用户的家目录（默认为/home/username） |
  | -e   | 账户的到期时间，格式为 YYYY-MM-DD.       |
  | -u   | 指定该用户的默认 UID                     |
  | -g   | 指定一个初始的用户基本组（必须已存在）   |
  | -G   | 指定一个或多个扩展用户组                 |
  | -N   | 不创建与用户同名的基本用户组             |
  | -s   | 指定该用户的默认 Shell 解释器            |

  

### groupadd 命令

- groupadd 命令用于创建用户组，格式为“groupadd [选项] 群组名”。

- 为了能够更加高效地指派系统中各个用户的权限，在工作中常常会把几个用户加入到同 一个组里面，这样便可以针对一类用户统一安排权限

### usermod 命令

- usermod 命令用于修改用户的属性，格式为“usermod [选项] 用户名”。
  | 参数  | 作用                                                         |
  | ----- | ------------------------------------------------------------ |
  | -c    | 填写用户账户的备注信息                                       |
  | -d -m | 参数-m 与参数-d 连用，可重新指定用户的家目录并自动把旧的数据转移过去 |
  | -e    | 账户的到期时间，格式为 YYYY-MM-DD                            |
  | -g    | 变更所属用户组                                               |
  | -G    | 变更扩展用户组                                               |
  | -L    | 锁定用户禁止其登录系统                                       |
  | -U    | 解锁用户，允许其登录系统                                     |
  | -s    | 变更默认终端                                                 |
  | -u    | 修改用户的 UID                                               |
  

### passwd 命令 

- passwd 命令用于修改用户密码、过期时间、认证信息等，格式为“passwd [选项] [用户名]”。

- 普通用户只能使用 passwd 命令修改自身的系统密码，而 root 管理员则有权限修改其他所 有人的密码。

- root 管理员在 Linux 系统中修改自己或他人的密码时不需要验证旧密 码。

  | 参数    | 作用                                                   |
  | ------- | ------------------------------------------------------ |
  | -l      | 锁定用户，禁止其登录                                   |
  | -u      | 解除锁定，允许用户登录                                 |
  | --stdin | 允许通过标准输入修改用户密码，如echo "NewPassWord"     |
  | -d      | 使该用户可用空密码登录系统                             |
  | -e      | 强制用户在下次登录时修改密码                           |
  | -S      | 显示用户的密码是否被锁定，以及密码所采用的加密算法名称 |

### userdel 命令 

- userdel 命令用于删除用户，格式为“userdel [选项] 用户名”。

  | 参数 | 作用                     |
  | ---- | ------------------------ |
  | -f   | 强制删除用户             |
  | -r   | 同时删除用户及用户家目录 |




### 文件权限与归属 

#### 文件类型常见的字符

- -：普通文件。
- d：目录文件。
- l：链接文件。
- b：块设备文件。 
- c：字符设备文件。 
- p：管道文件。

#### 文件权限的字符与数字表示

| 权限分配 | 文件- | 所有- | 者 | 文件- | 所属- | 组 | 其他- | - | 用户 |
| -------- | ---------- | ---- | ---- | ---------- | ---- | ---- | -------- | ---- | ---- |
| 权限项 | 读         | 写   | 执行 |   读         | 写   | 执行 |         读         | 写   | 执行 |
| 字符表示 | r | w | x | r | w | x | r | w | x |
| 数字表示 | 4 | 2 | 1 | 4 | 2 | 1 | 4 | 2 | 1 |

```bash
[root@linuxprobe ~]# ls -l initial-setup-ks.cfg 
-rw-r--r--. 1 root root 1083 Aug 31 11:41 initial-setup-ks.cfg
-：文件类型（普通文件）
rw-r--r--：访问权限（所有者权限为可读可写（rw-），所属组权限为可读（r--），其他人也只有可读权限（r--），）
root：属主
root：属组
1083：文件大小
Aug 31 11:41：修改时间
initial-setup-ks.cfg：文件名称

```

### 文件的特殊权限 

#### SUID 

- SUID 是一种对二进制程序进行设置的特殊权限，可以让二进制程序的执行者临时拥有属 主的权限（仅对拥有执行权限的二进制程序有效）。

#### SGID 

- SGID 主要实现如下两种功能：
  - 让执行者临时拥有属组的权限（对拥有执行权限的二进制程序进行设置）；
  - 在某个目录中创建的文件自动继承该目录的用户组（只可以对目录进行设置）。

#### chmod 命令

- chmod 命令是一个非常实用的命令，能够用来设置文件或目录的权限，格式为“chmod [参 数] 权限 文件或目录名称”

```ba
[root@linuxprobe ~]# ls -al test
-rw-rw-r--. 1 linuxprobe root 15 Feb 11 11:50 test
[root@linuxprobe ~]# chmod 760 test
[root@linuxprobe ~]# ls -l test
-rwxrw----. 1 linuxprobe root 15 Feb 11 11:50 test
```

#### chown 命令

- 设置文件或目录的所有者和所属组，其格式为“chown [参数] 所有者:所属组 文件或目录名称”

  ```bash
  [root@linuxprobe ~]# ls -l test
  -rwxrw----. 1 linuxprobe root 15 Feb 11 11:50 test
  [root@linuxprobe ~]# chown root:bin test
  [root@linuxprobe ~]# ls -l test
  -rwxrw----. 1 root bin 15 Feb 11 11:50 test 
  ```

  

#### SBIT

- SBIT 特殊权限位可确保用户只能删除自己的文件，而 不能删除其他用户的文件

- chmod  o+t 文件或目录名称



### 文件的隐藏属性 

#### chattr 命令 

- chattr 命令用于设置文件的隐藏权限，格式为“chattr [参数] 文件”

| 参数 | 作用                                                         |
| ---- | ------------------------------------------------------------ |
| i    | 无法对文件进行修改；若对目录设置了该参数，则仅能修改其中的子文件内容而 不能新建或删除文件 |
| a    | 仅允许补充（追加）内容，无法覆盖/删除内容（Append Only）     |
| S    | 文件内容在变更后立即同步到硬盘（sync）                       |
| s    | 彻底从硬盘中删除，不可恢复（用 0 填充原文件所在硬盘区域）    |
| A    | 不再修改这个文件或目录的最后访问时间（atim                   |
| b    | 不再修改文件或目录的存取时间                                 |
| D    | 检查压缩文件中的错误                                         |
| d    | 使用 dump 命令备份时忽略本文件/目录                          |
| c    | 默认将文件或目录进行压缩                                     |
| u    | 当删除该文件后依然保留其在硬盘中的数据，方便日后恢复         |
| t    | 让文件系统支持尾部合并（tail-merging）                       |
| x    | 可以直接访问压缩文件中的内容                                 |



#### lsattr 命令 

- lsattr 命令用于显示文件的隐藏权限，格式为“lsattr [参数] 文件”



### 文件访问控制列表 

#### setfacl 命令

- setfacl 命令用于管理文件的 ACL 规则，格式为“setfacl [参数] 文件名称”

- 针对目录 文件需要使用-R 递归参数；针对普通文件则使用-m 参数；如果想要删除某个文件的 ACL， 则可以使用-b 参数

#### getfacl 命令 

- getfacl 命令用于显示文件上设置的 ACL 信息，格式为“getfacl 文件名称”。



### su 命令与 sudo 服务 

| 参数               | 作用                                                     |
| ------------------ | -------------------------------------------------------- |
| -h                 | 列出帮助信息                                             |
| -l                 | 列出当前用户可执行的命令                                 |
| -u 用户名或 UID 值 | 以指定的用户身份执行命令                                 |
| -l                 | 清空密码的有效时间，下次执行 sudo 时需要再次进行密码验证 |
| -b                 | 在后台执行指定的命令                                     |
| -p                 | 更改询问密码的提示语                                     |

- sudo 命令具有如下功能：
  - 限制用户执行指定的命令
  - 记录用户执行的每一条命令
  - 配置文件（/etc/sudoers）提供集中的用户管理、权限与主机等参数
  - 验证密码的后 5 分钟内（默认值）无须再让用户再次验证密码

- 如果担心直接修改配置文件会出现问题，则可以使用 sudo 命令提供的 visudo 命令 来配置用户权限。这条命令在配置用户权限时将禁止多个用户同时修改 sudoers 配置文件，还 可以对配置文件内的参数进行语法检查，并在发现参数错误时进行报错
- 只有 root 管理员才可以使用 visudo 命令编辑 sudo 服务的配置文件。



## 存储结构与磁盘划分

### 一切从“/”开始 

- 最常见的目录以及所对应的 存放内容

  | 目录名称    | 应放置文件的内容                                            |
  | ----------- | ----------------------------------------------------------- |
  | /boot       | 开机所需文件—内核、开机菜单以及所需配置文件等               |
  | /dev        | 以文件形式存放任何设备与接口                                |
  | /etc        | 配置文件                                                    |
  | /home       | 用户家目录                                                  |
  | /bin        | 存放单用户模式下还可以操作的命令                            |
  | /lib        | 开机时用到的函数库，以及/bin 与/sbin 下面的命令要调用的函数 |
  | /sbin       | 开机过程中需要的命令                                        |
  | /media      | 用于挂载设备文件的目录                                      |
  | /opt        | 放置第三方的软件                                            |
  | /root       | 系统管理员的家目录                                          |
  | /srv        | 一些网络服务的数据文件目录                                  |
  | /tmp        | 任何人均可使用的“共享”临时目录                              |
  | /proc       | 虚拟文件系统，例如系统内核、进程、外部设备及网络状态等      |
  | /usr/local  | 用户自行安装的软件                                          |
  | /usr/sbin   | Linux 系统开机时不会使用到的软件/命令/脚本                  |
  | /usr/share  | 帮助与说明文件，也可放置共享文件                            |
  | /var        | 主要存放经常变化的文件，如日志                              |
  | /lost+found | 当文件系统发生错误时，将一些丢失的文件片段存放在这里        |

- 绝对路径（absolute path）
- 相对路径（relative path）

### 物理设备的命名规则 

- 常见的硬件设备及其文件名称

  | 硬件设备       | 文件名称            |
  | -------------- | ------------------- |
  | IDE 设备       | /dev/hd[a-d]        |
  | SCSI/SATA/U 盘 | /dev/sd[a-p]        |
  | 软驱           | /dev/fd[0-1]        |
  | 打印机         | /dev/lp[0-15]       |
  | 光驱           | /dev/cdrom          |
  | 鼠标           | /dev/mouse          |
  | 磁带机         | /dev/st0 或/dev/ht0 |

- 由于现在的 IDE 设备已经很少见了，所以一般的硬盘设备都会是以“/dev/sd”开头的。 而一台主机上可以有多块硬盘，因此系统采用 a～p 来代表 16 块不同的硬盘（默认从 a 开始 分配），而且硬盘的分区编号也很有讲究：

  - 主分区或扩展分区的编号从 1 开始，到 4 结束；
  - 逻辑分区从编号 5 开始。

### 文件系统与数据资料 

- Linux 系统支持数十种的文件系统，而最常见的文件系统：
  - Ext3：是一款日志文件系统，能够在系统异常宕机时避免文件系统资料丢失，并 能自动修复数据的不一致与错误。然而，当硬盘容量较大时，所需的修复时间也 会很长，而且也不能百分之百地保证资料不会丢失。它会把整个磁盘的每个写入 动作的细节都预先记录下来，以便在发生异常宕机后能回溯追踪到被中断的部分， 然后尝试进行修复
  - Ext4：Ext3 的改进版本，作为 RHEL 6 系统中的默认文件管理系统，它支持的存储容 量高达 1EB（1EB=1,073,741,824GB），且能够有无限多的子目录。另外，Ext4 文件系 统能够批量分配 block 块，从而极大地提高了读写效率。
  - XFS：是一种高性能的日志文件系统，而且是 RHEL 7 中默认的文件管理系统，它的 优势在发生意外宕机后尤其明显，即可以快速地恢复可能被破坏的文件，而且强大的 日志功能只用花费极低的计算和存储性能。并且它最大可支持的存储容量为 18EB， 这几乎满足了所有需求。

### 挂载硬件设备

 #### mount 命令 

- mount 命令用于挂载文件系统，格式为“mount 文件系统 挂载目录”。

  | 参数 | 作用                                  |
  | ---- | ------------------------------------- |
  | -a   | 挂载所有在/etc/fstab 中定义的文件系统 |
  | -t   | 指定文件系统的类型                    |

  把设备/dev/sdb2 挂载到/backup 目录（临时，重启失效）

  ```bash
  [root@linuxprobe ~]# mount /dev/sdb2 /backup 
  ```

  想让硬件设备和目录永久地进行自动关联，必须把挂载信息按照指定的填写格式 “设备文件 挂载目录 格式类型 权限选项 自检 优先级”（各字段的意义见表 6-4）写入到 /etc/fstab 文件中。

  | 字段     | 意义                                                         |
  | -------- | ------------------------------------------------------------ |
  | 设备文件 | 一般为设备的路径+设备名称，也可以写唯一识别码（UUID，Universally Unique Identifier） |
  | 挂载目录 | 指定要挂载到的目录，需在挂载前创建好                         |
  | 格式类型 | 指定文件系统的格式，比如 Ext3、Ext4、XFS、SWAP、iso9660（此为光盘设备）等 |
  | 权限选项 | 若设置为 defaults，则默认权限为：rw, suid, dev, exec, auto, nouser, async |
  | 自检     | 若为 1 则开机后进行磁盘自检，为 0 则不自检                   |
  | 优先级   | 若“自检”字段为 1，则可对多块硬盘进行自检优先级设置           |

  ```bash
  [root@linuxprobe ~]# vim /etc/fstab
  #
  # /etc/fstab
  # Created by anaconda on Wed May 4 19:26:23 2017
  #
  # Accessible filesystems, by reference, are maintained under '/dev/disk'
  # See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
  #
  ......
  .....
  ....
  /dev/sdb2 /backup ext4 defaults 0 0
  ```

#### umount 命令

- umount 命令用于撤销已经挂载的设备文件，格式为“umount [挂载点/设备文件]”

  ```bash
  [root@linuxprobe ~]# umount /dev/sdb2 
  ```

### 添加硬盘设备

#### fdisk 命令

- fdisk 命令用于管理磁盘 分区，格式为“fdisk [磁盘名称]”

  | 参数 | 作用                   |
  | ---- | ---------------------- |
  | m    | 查看全部可用的参数     |
  | n    | 添加新的分区           |
  | d    | 删除某个分区信息       |
  | l    | 列出所有可用的分区类型 |
  | t    | 改变某个分区的类型     |
  | p    | 查看分区信息           |
  | w    | 保存并退出             |
  | q    | 不保存直接退出         |

#### du 命令

- 查看文件数据占用量的 du 命令，其格式为“du [选项] [文件]”。

### 添加交换分区 

- SWAP（交换）分区是一种通过在硬盘中预先划分一定的空间，然后将把内存中暂时不常 用的数据临时存放到硬盘中，以便腾出物理内存空间让更活跃的程序服务来使用的技术，其设 计目的是为了解决真实物理内存不足的问题

- 但由于交换分区毕竟是通过硬盘设备读写数据的， 速度肯定要比物理内存慢，所以只有当真实的物理内存耗尽后才会调用交换分区的资源

  

### 磁盘容量配额

- 以使用 quota 命令进行磁盘容量配额管理，从而限制用户的硬盘可用容量或所能创建的最大文件个数
- quota 命令还有软限制和硬限制的功能
  - 软限制：当达到软限制时会提示用户，但仍允许用户在限定的额度内继续使用。
  - 硬限制：当达到硬限制时会提示用户，且强制终止用户的操作。

#### xfs_quota 命令 

- xfs_quota 命令是一个专门针对 XFS 文件系统来管理 quota 磁盘容量配额服务而设计的命令， 格式为“quota [参数] 配额 文件系统”。
  - -c 参数用于以参数的形式设置要执行的命令
  - -x 参数是专家模式，让运维人员能够对 quota 服务进行更多复杂的配置。

#### edquota 命令

- edquota 命令用于编辑用户的 quota 配额限制，格式为“edquota [参数] [用户] ”。
  - -u 参数表示要针对哪个用户进行设置；
  - -g 参数表示要针对哪个用户组进行设置

### 软硬方式链接

- 硬链接（hard link）：硬链接文件与原始文件其实是同一个文件，只 是名字不同
- 软链接（也称为符号链接[symbolic link]）：仅仅包含所链接文件的路径名，因此能链 接目录文件，也可以跨越文件系统进行链接。但是，当原始文件被删除后，链接文件 也将失效。

#### ln 命令

- ln 命令用于创建链接文件，格式为“ln [选项] 目标”

  | 参数 | 作用                                                |
  | ---- | --------------------------------------------------- |
  | -s   | 创建“符号链接”（如果不带-s 参数，则默认创建硬链接） |
  | -f   | 强制创建文件或目录的链接                            |
  | -i   | 覆盖前先询问                                        |
  | -v   | 显示创建链接的过程                                  |

  